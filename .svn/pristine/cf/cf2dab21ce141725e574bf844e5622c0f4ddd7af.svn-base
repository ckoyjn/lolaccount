<%@ page language="java" contentType="text/html; charset=gbk"
    pageEncoding="gbk"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="1280*720;text/html; charset=gbk">
<title>预告片</title>
<style>
* {margin:0px;padding:0px; font-family:Microsoft Yahei;}
body {
    width:1280px;
    height:720px;
    font-size: 28px;
    background-color:white;
}
ul,p,h1,h2,h3,h4,h5,h6,dl,dd,dt,button,input,marquee,table{margin: 0px; padding: 0px;}
div,li{list-style: none; list-style-type:none;}
img,p{border: 0;}
input,marquee{outline:none; border: none; border: 0; border-color: transparent;}
a{text-decoration: none; color: #ffffff}
#list{

    position: absolute;
    width: 1195px;
    height: 445px;
    left: 50px;
    top: 130px;
}
.background{
    width:1280px;
    height:720px;
    left:14px;
    position:absolute;
    top:3px;
    background-image:url(../static/epgimg/040506_bj.jpg)
}

.movie{
    width: 280px;
    height: 215px;
    margin: 0px 0px 30px 10px;
    float: left;
    display: none;
}
.button{
    position: absolute;
    top: 635px;
}
.movie div{
    
    width: 153px;
    height: 213px;
    float: left;
}
ul li{
    color:white;
    font-size:14px;
    position:relative;
    left:4px;
    margin:10px 0px 0px 20px;
}
li.title{
    font-size:18px;
    margin-bottom: 20px;
}
li.zy{
    color:#0072ff;
}
li.casttime{
    color:#0072ff;
}
#wxts{
    position:absolute;
    background: url(../static/epgimg/dgts.png);
    width:594px;
    height:413px;
    left:343px;
    top:150px;
}

.button{
    position: absolute;
    top: 635px;
}
.previewimg{
	width:140px;
	height: 200px;
}
</style>
<script type="text/javascript" src="../static/js/epgCommon.js"></script>
<script type="text/javascript" src="../static/js/epgCQ.js"></script>
</head>
<body>
<div id="screen" style="position: absolute;background: url('../static/epgimg/screen.png'); width: 1280px; height: 720px;display:none;">
        </div>
<div id="main" class="background">
    <div id="list">
        <div class="movie" id="movie_0">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_1">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_2">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_3">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_4">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_5">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_6">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
         <div class="movie" id="movie_7">
            <div>
                <img alt="" src="" style="margin: 6px;" class="previewimg">
            </div>
            <ul>
                <li class="title"></li>
                <li class="zy">主演：</li>
                <li></li>
                <li class="casttime">即将上线：</li>
                <li></li>
            </ul>
         </div> 
    </div>
	<img id="yxry" src="../static/epgimg/yxtb.png" class="button" style="left:215px;"/>
	<img id="gdjc" src="../static/epgimg/gdjc.png" class="button" style="left:430px;"/>
	<img id="jjcx" src="../static/epgimg/jjcx_f.png" class="button" style="left:640px;"/>
	<img id="wdsf" src="../static/epgimg/wdsf.png" class="button" style="left:850px;"/>
	<img id="btnFocus" src="../static/epgimg/btnFocus.png" style="position: absolute;  top: 630px;  left: 210px; display:none;">
    
    <div id="wxts" style="display:none;">
            <div id="wxtsmsg" style="position: absolute;  color: white;  left: 38px;  width: 496px;  text-align: center;  top: 130px;">hahahaha</div>
            <img src="../static/epgimg/fh_f.png" style="position: absolute;  top: 261px;  left: 220px;">
        </div>
    <%@ include file="quit.jsp" %>
    <iframe id="data_ifm" style="display:none;"></iframe>
</div>
<script>
var URL = {
    ipaddr:ipaddress,
    preview:"/REST/movie/preview"
}

var config={
        smartcardid:getCANO()
}

function preview(param) {
    var url = URL.ipaddr+URL.preview;
    var data="{\"smartcardid\":\""+config.smartcardid+"\"}"; 
    var sucFunc=param.sucFunc;
    var failFunc=param.failFunc;
    ajax({url:url,data:data,method:"post",handler:function(xmlHttp){
        var result = eval("("+xmlHttp.responseText+")");
        if(result.errCode==0){
            sucFunc(result);
        }else{
            failFunc(result);
        }
    }});
}

var list = {
    index:0,
    size:0,
    data:[],
    init:function(){
        this.size=this.data.length;
        this.refresh();
        this.setFocus();
    },
    refresh:function(){
        for(var i=0;i<this.size;i++){
            $("movie_"+i).style.display="block";
            $("movie_"+i).getElementsByTagName("img")[0].src="../static/epgimg/preview/"+this.data[i].identify+"_preview.jpg";
            $("movie_"+i).getElementsByTagName("li")[0].innerHTML=this.data[i].name;
            $("movie_"+i).getElementsByTagName("li")[2].innerHTML=this.data[i].actor;
            $("movie_"+i).getElementsByTagName("li")[4].innerHTML=this.data[i].casttime.substr(0,8);
        }       
    },
    setFocus:function(){
        $("movie_"+this.index).getElementsByTagName("div")[0].style.background="url(../static/epgimg/020506pic_jdk.png)";
    },
    blur:function(){
        $("movie_"+this.index).getElementsByTagName("div")[0].style.background="";
    },
    moveLeft:function(){
        this.blur();
        this.index=this.index-1<0?this.size-1:this.index-1;
        this.setFocus();
    },
    moveRight:function(){
        this.blur();
        this.index=this.index+1==this.size?0:this.index+1;
        this.setFocus();
    },
    moveDown:function(){
        this.blur();
        this.index=this.index+4<=this.size-1?this.index+4:4;
        this.setFocus();
    },
    moveUp:function(){
        this.blur();
        this.index=this.index-4;
        this.setFocus();
    },
    enter:function(){
    	insRecord({action:17,previewid:this.data[this.index].id});//预告片播放
		location.href=this.data[this.index].playUrl+userId;
    }
}

var userId=getGlobalVar("userId");

var wxts={
        ok:function(){
            windows.hidden();
        }   
    }

var area=0;/*0-list 1-下方按钮*/
function moveLeft(){
    if (!windows.flag) {
        if(area==0){
            list.moveLeft();
        }else if(area==1){
            if(focusIndex==0)
                setFocus(3);
            else
                setFocus(focusIndex-1);
        }
    }else{
        window[windows.key].moveLeft();
    }
}

function moveRight(){
    if (!windows.flag) {
        if(area==0){
            list.moveRight();
        }else if(area==1){
            if(focusIndex==3)
                setFocus(0);
            else
                setFocus(focusIndex+1);
        }
    }else{
        window[windows.key].moveRight();
    }
}

function moveDown(){
    if (!windows.flag) {
        if(area==0){
            if(list.size>4 && list.index<4) {
                list.moveDown();
            }else{
                list.blur();
                setFocus(focusIndex);
                area=1;
            }
        }
    }else{
        window[windows.key].moveDown();
    }
}

function moveUp(){
    if (!windows.flag) {
        if(area==1){
            list.setFocus();
            buttonBlur();
            area=0;
        }else if(area==0){
            if(list.index>3){
                list.moveUp();
            }
        }
    }else{
        window[windows.key].moveUp();
    }
}

function doConfirm(){
    if (!windows.flag) {
        if(area==0){
            list.enter();
        }else if(area==1){
            buttonClick();
        }
    }else{
        window[windows.key].ok();
    }
}

window.onload=function(){

     preview({sucFunc:function(result){
          list.data=result.list;
          list.init();
    }});
     
    focusIndex=2;
}
</script>
</body>
</html>
