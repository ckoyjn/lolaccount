<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.guanglumedia.cms.order.dao.OrderDao">

	<select id="findOrderList" resultType="map" parameterType="com.guanglumedia.cms.order.entity.Order">
		SELECT SQL_CALC_FOUND_ROWS t.*,p.name AS productname,w.Name AS filmName,t.price FROM trxnlog t LEFT JOIN product p ON
		t.`productId`=p.`vodid`
		LEFT JOIN
		movie w ON t.`MediaID`=w.`MediaID`
		<where>
			<if test="id!=null">
				and t.id=#{id}
			</if>
			<if test="userId!=null and userId!='' ">
				and t.userId like CONCAT('%', #{userId},'%')
			</if>
			<if test="filmName!=null and filmName!=''">
				and w.name like CONCAT('%', #{filmName},'%')
			</if>
		</where>
		order by recordtime desc
	</select>
	<!-- <select id="findCount" resultType="int" parameterType="com.guanglumedia.cms.order.entity.Order"> 
		SELECT count(*) FROM trxnlog t LEFT JOIN product p ON t.`productId`=p.`vodid` 
		LEFT JOIN preview w ON t.`MediaID`=w.`MediaID` <where> <if test="id!=null"> 
		and t.id=#{id} </if> <if test="userId!=null and userId!='' "> and t.userId 
		like CONCAT('%', #{userId},'%') </if> <if test="filmName!=null and filmName!=''"> 
		and p.name like CONCAT('%', #{filmName},'%') </if> </where> </select> -->
	<select id="findCount" resultType="int">
		select FOUND_ROWS()
	</select>
	<select id="findAllProductId" resultType="map">
		select vodid,`status` from
		product
	</select>
	<select id="findAllMediaId" resultType="map">
		select MediaID,`status` from
		movie
	</select>
	<insert id="addOrder" parameterType="com.guanglumedia.cms.order.entity.Order">
		insert into trxnlog (userId,productId,MediaID,recordtime)
		values(#{userId},#{productId},#{mediaId},#{recordtime})
	</insert>
	
	<select id="exportOrder" resultType="map" parameterType="com.guanglumedia.cms.order.entity.Order">
        SELECT  t.*,p.name AS productname,w.Name AS filmName,p.price FROM trxnlog t LEFT JOIN product p ON
        t.`productId`=p.`vodid`
        LEFT JOIN
        movie w ON t.`MediaID`=w.`MediaID`
        <where>
            <if test="id!=null">
                and t.id=#{id}
            </if>
            <if test="userId!=null and userId!='' ">
                and t.userId like CONCAT('%', #{userId},'%')
            </if>
            <if test="filmName!=null and filmName!=''">
                and w.name like CONCAT('%', #{filmName},'%')
            </if>
        </where>
    </select>
</mapper>	